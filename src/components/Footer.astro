---
import type { Links } from "@/data/layout/links"; 
import { linksData } from "@/data/layout/links";
import Linksfooter from "./Linksfooter.astro";
import { Icon } from "astro-icon/components";
---

<footer>
    <div class="flex flex-col  justify-center gap-5 border-y-[1px] border-blue-400 py-4 mt-8 items-center bg-blk-gray-dark ">
        <!-- <IcoAtom name="logo" wi="3rem" he="3rem" /> -->
        <!-- <Icon class="text-sky-600 text-6xl" name="lucide:atom" /> -->
         <div class="flex justify-around items-center md:flex-row flex-col w-full px-4 gap-y-4">
            <div class="flex items-center">

                <picture class="w-16 h-auto ">
                    <a href="/">
                        <img class="rounded-lg hover:animate-shake transition-all duration-1000 ease-in-out" src="https://www.onthepointservice.com/img/onthepointservice.png" alt="Logo Empresa">
                    </a>
                </picture>
            </div>
            <nav class="flex flex-col md:flex-row gap-3 items-center">
                {linksData.map((link: Links) => <Linksfooter {...link}/>)}
            </nav>
         </div>

         <div class="flex flex-col md:flex-row justify-between items-center border-t border-blue-400  pt-4">
            <!-- Social Networks -->
            <div class="flex gap-2">
                <a href="https://www.instagram.com/geniusbartechnology/"  aria-label="facebook" ><Icon class=" text-pink-instagram animate-pulse transition-all duration-500 text-4xl" name="lucide:instagram" /></a>
                <a href="https://www.facebook.com/Barradeatomo"  aria-label="instagram"><Icon class="text-blue-facebook animate-pulse transition-all duration-500 text-4xl" name="lucide:facebook" /></a>
            </div>

            <form id="subscribe-form" action="/api/subscribe" method="POST" class="flex flex-col sm:flex-row items-center gap-2 mt-4 ms-0 md:mt-0 md:ms-8">
                <input name="email" type="email" placeholder="Tu correo electrónico" class="px-4 py-2 border rounded bg-gray-700 text-white" required>
                <button type="submit" class="bg-blue-500 text-white font-apple font-bold px-4 py-2 rounded hover:scale-custom2 hover:animate-pulse transition-all ease-in-out duration-500">Suscribirse</button>
                <p id="subscribe-message" class="text-sm mt-2 sm:mt-0 sm:ml-4"></p>
            </form>
         </div>

         <div class="flex flex-col justify-center items-center border-t border-blue-400 pt-4">
           
             <div class="flex flex-col md:flex-row justify-center items-center gap-4 pb-4">
                <p class="font-apple font-bold text-center text-white">
                  Puedes Pagar Con:
                </p>
                
                    <img class="overflow-hidden w-[60px] h-[40px] object-cover" src="https://i.imgur.com/xm8TQC3.png" alt="visa" />
            
               
                    <img class="overflow-hidden w-[60px] h-[40px] object-cover" src="https://i.imgur.com/uuLL15w.png" alt="MasterCard" />
               
              
                    <img class="overflow-hidden w-[60px] h-[40px] object-cover" src="https://i.imgur.com/Ibf7JfX.png" alt="AmercanExpress" />  
              
                </div>
                <div class="flex flex-col justify-center items-center">
                    <p class="font-apple font-bold">Tranferencia <wbr />/ Deposito Bancario</p>
                </div>
          
         </div>

        <div class="flex justify-center items-center  border-t-[1px] border-blue-400 py-4 mt-8  bg-blk-gray-dark w-full h-full text-xs md:text-lg">
            <p class="text-mainbrand-light"><span class="text-sky-600 font-apple font-bold ">OnthePointService (2017)</span> © 2025 Desarrollado por <a class="hover:underline text-mainbrand-light " href="mailto:onthepointservice@gmail.com">juanmdev</a></p>
        </div>
    </div>
</footer>

<script>
    const form = document.getElementById('subscribe-form') as HTMLFormElement;
    const messageEl = document.getElementById('subscribe-message') as HTMLParagraphElement;

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const button = form.querySelector('button[type="submit"]') as HTMLButtonElement;

        messageEl.textContent = 'Enviando...';
        messageEl.className = 'text-white';
        button.disabled = true;

        try {
            const response = await fetch('/api/subscribe', {
                method: 'POST',
                body: formData,
            });

            if (response.ok || (response.redirected && response.status === 200)) { // 303 redirige y fetch lo sigue, resultando en 200 OK
                messageEl.textContent = '¡Gracias por suscribirte!';
                messageEl.className = 'text-green-400';
                form.reset();
            } else { // Captura errores 400, 409, 500, etc.
                messageEl.textContent = 'Este correo ya está suscrito o es inválido.';
                messageEl.className = 'text-red-400';
            }
        } catch (error) {
            messageEl.textContent = 'Error de red. Inténtalo de nuevo.';
            messageEl.className = 'text-red-400';
        } finally {
            button.disabled = false;
            setTimeout(() => { messageEl.textContent = ''; }, 5000);
        }
    });
</script>
